2025-06-17 21:30:35,553 - INFO - FixedBCRL_131295974822864 - Shared experiment log directory: fixed_behavioral_cloning_final_2025-06-17_21-30-35/logs
2025-06-17 21:30:35,553 - INFO - FixedBCRL_131295974822864 - üéì FIXED BEHAVIORAL CLONING + SPARSE ACTION RL
2025-06-17 21:30:35,553 - INFO - FixedBCRL_131295974822864 - ============================================================
2025-06-17 21:30:35,553 - INFO - FixedBCRL_131295974822864 - üîß All shape and interface issues fixed
2025-06-17 21:30:35,553 - INFO - FixedBCRL_131295974822864 - üéØ Optimized for sparse surgical actions (0-3 out of 100)
2025-06-17 21:30:35,553 - INFO - FixedBCRL_131295974822864 - üìÇ Step 1: Loading data...
2025-06-17 21:30:35,553 - INFO - FixedBCRL_131295974822864 - Loading train data from /home/maxboels/datasets/CholecT50 with fold 0
2025-06-17 21:30:35,942 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded metadata: /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (78968, 156)
2025-06-17 21:30:35,942 - INFO - FixedBCRL_131295974822864 - [Train] Start processing metadata file /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:30:35,942 - INFO - FixedBCRL_131295974822864 - [Train] Rewards extraction skipped, using metadata file /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:30:35,944 - INFO - FixedBCRL_131295974822864 - [Train] Found 20 videos in metadata file
2025-06-17 21:30:35,944 - INFO - FixedBCRL_131295974822864 - [Train] Loading data for 20 videos
2025-06-17 21:30:36,016 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID01: 1734 frames, 1024-dims embeddings
2025-06-17 21:30:36,079 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID04: 1523 frames, 1024-dims embeddings
2025-06-17 21:30:36,173 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID05: 2345 frames, 1024-dims embeddings
2025-06-17 21:30:36,236 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID08: 1520 frames, 1024-dims embeddings
2025-06-17 21:30:36,307 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID10: 1750 frames, 1024-dims embeddings
2025-06-17 21:30:36,396 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID103: 2220 frames, 1024-dims embeddings
2025-06-17 21:30:36,484 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID110: 2177 frames, 1024-dims embeddings
2025-06-17 21:30:36,530 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID12: 1091 frames, 1024-dims embeddings
2025-06-17 21:30:36,571 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID13: 982 frames, 1024-dims embeddings
2025-06-17 21:30:36,654 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID15: 2059 frames, 1024-dims embeddings
2025-06-17 21:30:36,734 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID18: 1943 frames, 1024-dims embeddings
2025-06-17 21:30:36,797 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID22: 1533 frames, 1024-dims embeddings
2025-06-17 21:30:36,873 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID26: 1774 frames, 1024-dims embeddings
2025-06-17 21:30:36,962 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID27: 2085 frames, 1024-dims embeddings
2025-06-17 21:30:37,059 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID29: 2351 frames, 1024-dims embeddings
2025-06-17 21:30:37,224 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID31: 3946 frames, 1024-dims embeddings
2025-06-17 21:30:37,309 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID32: 2117 frames, 1024-dims embeddings
2025-06-17 21:30:37,398 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID35: 2107 frames, 1024-dims embeddings
2025-06-17 21:30:37,498 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID36: 2388 frames, 1024-dims embeddings
2025-06-17 21:30:37,591 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID40: 2223 frames, 1024-dims embeddings
2025-06-17 21:30:37,592 - INFO - FixedBCRL_131295974822864 - üìÇ Loaded 20 videos from train split
2025-06-17 21:30:37,593 - INFO - FixedBCRL_131295974822864 - Loading test data from /home/maxboels/datasets/CholecT50 with fold 0
2025-06-17 21:30:37,683 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded metadata: /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (21895, 156)
2025-06-17 21:30:37,683 - INFO - FixedBCRL_131295974822864 - [Test] Start processing metadata file /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:30:37,683 - INFO - FixedBCRL_131295974822864 - [Test] Rewards extraction skipped, using metadata file /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:30:37,684 - INFO - FixedBCRL_131295974822864 - [Test] Found 8 videos in metadata file
2025-06-17 21:30:37,684 - INFO - FixedBCRL_131295974822864 - [Test] Loading data for 8 videos
2025-06-17 21:30:37,796 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID02: 2840 frames, 1024-dims embeddings
2025-06-17 21:30:37,883 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID06: 2154 frames, 1024-dims embeddings
2025-06-17 21:30:37,969 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID111: 2146 frames, 1024-dims embeddings
2025-06-17 21:30:38,038 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID14: 1709 frames, 1024-dims embeddings
2025-06-17 21:30:38,104 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID23: 1636 frames, 1024-dims embeddings
2025-06-17 21:30:38,191 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID25: 2130 frames, 1024-dims embeddings
2025-06-17 21:30:38,236 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID50: 1095 frames, 1024-dims embeddings
2025-06-17 21:30:38,355 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded video VID51: 2945 frames, 1024-dims embeddings
2025-06-17 21:30:38,356 - INFO - FixedBCRL_131295974822864 - üìÇ Loaded 8 videos from test split
2025-06-17 21:30:38,356 - INFO - FixedBCRL_131295974822864 - ‚úÖ Data loaded: 20 train, 8 test videos
2025-06-17 21:30:38,356 - INFO - FixedBCRL_131295974822864 - üìÇ Step 2: Loading trained models...
2025-06-17 21:30:40,065 - INFO - FixedBCRL_131295974822864 - ‚úÖ World model loaded successfully
2025-06-17 21:30:40,065 - INFO - FixedBCRL_131295974822864 - üîß Step 3: Creating adapter and collecting demonstrations...
2025-06-17 21:30:40,537 - INFO - FixedBCRL_131295974822864 - ‚úÖ Loaded supervised model for behavioral cloning
2025-06-17 21:30:40,537 - INFO - FixedBCRL_131295974822864 -    Original performance: 48.3% mAP
2025-06-17 21:30:40,537 - INFO - FixedBCRL_131295974822864 -    Model handles sparse actions (0-3 out of 100)
2025-06-17 21:30:40,537 - INFO - FixedBCRL_131295974822864 - üìä Collecting expert demonstrations...
2025-06-17 21:30:40,992 - INFO - FixedBCRL_131295974822864 - ‚úÖ Collected 200 demonstrations
2025-06-17 21:30:40,992 - INFO - FixedBCRL_131295974822864 -    Average active actions: 1.2
2025-06-17 21:30:40,992 - INFO - FixedBCRL_131295974822864 -    Action sparsity: 98.8%
2025-06-17 21:30:40,992 - INFO - FixedBCRL_131295974822864 - üéØ Step 4: Creating improved sparse action environment...
2025-06-17 21:30:40,993 - INFO - FixedBCRL_131295974822864 - üéØ Improved Sparse Action Environment initialized
2025-06-17 21:30:40,993 - INFO - FixedBCRL_131295974822864 -    Max episode steps: 15
2025-06-17 21:30:40,993 - INFO - FixedBCRL_131295974822864 -    Reward weights: {'sparse_expert_f1': 50.0, 'precision_bonus': 30.0, 'recall_bonus': 20.0, 'sparsity_match': 15.0, 'false_positive_penalty': 25.0, 'completion_bonus': 5.0}
2025-06-17 21:30:40,993 - INFO - FixedBCRL_131295974822864 - üîß Testing environment...
2025-06-17 21:30:41,001 - INFO - FixedBCRL_131295974822864 - ‚úÖ Environment test successful - Reward: 0.500
2025-06-17 21:30:41,001 - INFO - FixedBCRL_131295974822864 - üéì Step 5: Creating and warm-starting RL policy...
2025-06-17 21:30:41,001 - INFO - FixedBCRL_131295974822864 - üîß Creating calibrated RL policy from supervised model...
2025-06-17 21:30:41,025 - INFO - FixedBCRL_131295974822864 - üéì Performing imitation learning warm start...
2025-06-17 21:30:41,025 - INFO - FixedBCRL_131295974822864 -    Using 200 demonstrations
2025-06-17 21:30:41,025 - INFO - FixedBCRL_131295974822864 -    Training for 3 epochs
2025-06-17 21:30:41,026 - INFO - FixedBCRL_131295974822864 -    State shape: (200, 1024)
2025-06-17 21:30:41,026 - INFO - FixedBCRL_131295974822864 -    Action shape: (200, 100)
2025-06-17 21:30:41,088 - INFO - FixedBCRL_131295974822864 -    Epoch 1/3: Avg action difference = 0.0162
2025-06-17 21:30:41,151 - INFO - FixedBCRL_131295974822864 -    Epoch 2/3: Avg action difference = 0.0153
2025-06-17 21:30:41,221 - INFO - FixedBCRL_131295974822864 -    Epoch 3/3: Avg action difference = 0.0150
2025-06-17 21:30:41,222 - INFO - FixedBCRL_131295974822864 - ‚úÖ Imitation learning warm start completed
2025-06-17 21:30:41,222 - INFO - FixedBCRL_131295974822864 -    Note: Using lightweight approach due to PPO policy constraints
2025-06-17 21:30:41,222 - INFO - FixedBCRL_131295974822864 - üîç Step 6: Initial evaluation after warm start...
2025-06-17 21:30:41,238 - INFO - FixedBCRL_131295974822864 -    Sparsity check - Expert: 1.4, Predicted: 0.0
2025-06-17 21:30:41,239 - INFO - FixedBCRL_131295974822864 -    Initial mAP after warm start: 0.1753
2025-06-17 21:30:41,239 - INFO - FixedBCRL_131295974822864 - üöÄ Step 7: RL training with sparse action optimization...
2025-06-17 21:30:43,000 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2092, Episodes: 33
2025-06-17 21:30:44,504 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2224, Episodes: 66
2025-06-17 21:30:46,182 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2223, Episodes: 100
2025-06-17 21:30:47,582 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2118, Episodes: 133
2025-06-17 21:30:49,518 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2209, Episodes: 166
2025-06-17 21:30:51,421 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2341, Episodes: 200
2025-06-17 21:30:53,171 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2437, Episodes: 233
2025-06-17 21:30:54,678 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2528, Episodes: 266
2025-06-17 21:30:56,462 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2258, Episodes: 300
2025-06-17 21:30:58,147 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2239, Episodes: 333
2025-06-17 21:30:59,767 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2111, Episodes: 366
2025-06-17 21:31:01,346 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2171, Episodes: 400
2025-06-17 21:31:03,021 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2171, Episodes: 433
2025-06-17 21:31:04,516 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2322, Episodes: 466
2025-06-17 21:31:06,138 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2188, Episodes: 500
2025-06-17 21:31:07,754 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2213, Episodes: 533
2025-06-17 21:31:09,509 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2150, Episodes: 566
2025-06-17 21:31:11,302 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2320, Episodes: 600
2025-06-17 21:31:13,001 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2179, Episodes: 633
2025-06-17 21:31:14,824 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2421, Episodes: 666
2025-06-17 21:31:16,535 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2621, Episodes: 700
2025-06-17 21:31:18,227 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2575, Episodes: 733
2025-06-17 21:31:20,144 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2473, Episodes: 766
2025-06-17 21:31:21,997 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2450, Episodes: 800
2025-06-17 21:31:23,722 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2598, Episodes: 833
2025-06-17 21:31:25,565 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2661, Episodes: 866
2025-06-17 21:31:27,415 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2377, Episodes: 900
2025-06-17 21:31:29,113 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2432, Episodes: 933
2025-06-17 21:31:30,964 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2282, Episodes: 966
2025-06-17 21:31:32,687 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2316, Episodes: 1000
2025-06-17 21:31:34,680 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2348, Episodes: 1033
2025-06-17 21:31:36,687 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2203, Episodes: 1066
2025-06-17 21:31:38,680 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2574, Episodes: 1100
2025-06-17 21:31:40,466 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2449, Episodes: 1133
2025-06-17 21:31:42,298 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2376, Episodes: 1166
2025-06-17 21:31:44,188 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2447, Episodes: 1200
2025-06-17 21:31:46,072 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2325, Episodes: 1233
2025-06-17 21:31:47,800 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2373, Episodes: 1266
2025-06-17 21:31:49,897 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2312, Episodes: 1300
2025-06-17 21:31:51,692 - INFO - FixedBCRL_131295974822864 - Evaluation - mAP: 0.2242, Episodes: 1333
2025-06-17 21:31:52,051 - INFO - FixedBCRL_131295974822864 - üìä Step 8: Final evaluation...
2025-06-17 21:31:52,074 - INFO - FixedBCRL_131295974822864 -    Sparsity check - Expert: 1.3, Predicted: 0.0
2025-06-17 21:31:52,086 - INFO - FixedBCRL_131295974822864 - üéâ FIXED BEHAVIORAL CLONING RL COMPLETED!
2025-06-17 21:31:52,086 - INFO - FixedBCRL_131295974822864 - üìä Initial mAP: 0.1753
2025-06-17 21:31:52,086 - INFO - FixedBCRL_131295974822864 - üìä Final mAP: 0.1777
2025-06-17 21:31:52,086 - INFO - FixedBCRL_131295974822864 - üìä Improvement: +0.0023
2025-06-17 21:31:52,086 - INFO - FixedBCRL_131295974822864 - üìä vs Supervised baseline: 36.8%
2025-06-17 21:31:52,086 - INFO - FixedBCRL_131295974822864 - ‚úÖ EXCELLENT: RL with warm-start is highly competitive!
