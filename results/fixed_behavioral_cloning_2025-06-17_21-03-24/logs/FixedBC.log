2025-06-17 21:03:24,661 - INFO - FixedBC_138979809252256 - Shared experiment log directory: fixed_behavioral_cloning_2025-06-17_21-03-24/logs
2025-06-17 21:03:24,661 - INFO - FixedBC_138979809252256 - 🎓 FIXED BEHAVIORAL CLONING WARM-START + SPARSE ACTION RL
2025-06-17 21:03:24,661 - INFO - FixedBC_138979809252256 - ============================================================
2025-06-17 21:03:24,661 - INFO - FixedBC_138979809252256 - Goal: Fix overfitting and optimize for sparse actions (0-3 out of 100)
2025-06-17 21:03:24,661 - INFO - FixedBC_138979809252256 - Key insight: Most predictions should be near zero for this domain!
2025-06-17 21:03:24,661 - INFO - FixedBC_138979809252256 - 📂 Loading data...
2025-06-17 21:03:24,662 - INFO - FixedBC_138979809252256 - Loading train data from /home/maxboels/datasets/CholecT50 with fold 0
2025-06-17 21:03:25,072 - INFO - FixedBC_138979809252256 - ✅ Loaded metadata: /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (78968, 156)
2025-06-17 21:03:25,072 - INFO - FixedBC_138979809252256 - [Train] Start processing metadata file /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:03:25,072 - INFO - FixedBC_138979809252256 - [Train] Rewards extraction skipped, using metadata file /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:03:25,074 - INFO - FixedBC_138979809252256 - [Train] Found 15 videos in metadata file
2025-06-17 21:03:25,074 - INFO - FixedBC_138979809252256 - [Train] Loading data for 15 videos
2025-06-17 21:03:25,162 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID01: 1734 frames, 1024-dims embeddings
2025-06-17 21:03:25,228 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID04: 1523 frames, 1024-dims embeddings
2025-06-17 21:03:25,326 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID05: 2345 frames, 1024-dims embeddings
2025-06-17 21:03:25,393 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID08: 1520 frames, 1024-dims embeddings
2025-06-17 21:03:25,468 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID10: 1750 frames, 1024-dims embeddings
2025-06-17 21:03:25,561 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID103: 2220 frames, 1024-dims embeddings
2025-06-17 21:03:25,652 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID110: 2177 frames, 1024-dims embeddings
2025-06-17 21:03:25,702 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID12: 1091 frames, 1024-dims embeddings
2025-06-17 21:03:25,747 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID13: 982 frames, 1024-dims embeddings
2025-06-17 21:03:25,834 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID15: 2059 frames, 1024-dims embeddings
2025-06-17 21:03:25,916 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID18: 1943 frames, 1024-dims embeddings
2025-06-17 21:03:25,983 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID22: 1533 frames, 1024-dims embeddings
2025-06-17 21:03:26,061 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID26: 1774 frames, 1024-dims embeddings
2025-06-17 21:03:26,152 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID27: 2085 frames, 1024-dims embeddings
2025-06-17 21:03:26,254 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID29: 2351 frames, 1024-dims embeddings
2025-06-17 21:03:26,255 - INFO - FixedBC_138979809252256 - 📂 Loaded 15 videos from train split
2025-06-17 21:03:26,255 - INFO - FixedBC_138979809252256 - Loading test data from /home/maxboels/datasets/CholecT50 with fold 0
2025-06-17 21:03:26,350 - INFO - FixedBC_138979809252256 - ✅ Loaded metadata: /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (21895, 156)
2025-06-17 21:03:26,350 - INFO - FixedBC_138979809252256 - [Test] Start processing metadata file /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:03:26,350 - INFO - FixedBC_138979809252256 - [Test] Rewards extraction skipped, using metadata file /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-17 21:03:26,351 - INFO - FixedBC_138979809252256 - [Test] Found 10 videos in metadata file
2025-06-17 21:03:26,351 - INFO - FixedBC_138979809252256 - [Test] Loading data for 10 videos
2025-06-17 21:03:26,468 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID02: 2840 frames, 1024-dims embeddings
2025-06-17 21:03:26,556 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID06: 2154 frames, 1024-dims embeddings
2025-06-17 21:03:26,643 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID111: 2146 frames, 1024-dims embeddings
2025-06-17 21:03:26,714 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID14: 1709 frames, 1024-dims embeddings
2025-06-17 21:03:26,781 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID23: 1636 frames, 1024-dims embeddings
2025-06-17 21:03:26,870 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID25: 2130 frames, 1024-dims embeddings
2025-06-17 21:03:26,917 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID50: 1095 frames, 1024-dims embeddings
2025-06-17 21:03:27,043 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID51: 2945 frames, 1024-dims embeddings
2025-06-17 21:03:27,119 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID66: 1825 frames, 1024-dims embeddings
2025-06-17 21:03:27,260 - INFO - FixedBC_138979809252256 - ✅ Loaded video VID79: 3415 frames, 1024-dims embeddings
2025-06-17 21:03:27,260 - INFO - FixedBC_138979809252256 - 📂 Loaded 10 videos from test split
2025-06-17 21:03:27,260 - INFO - FixedBC_138979809252256 - 📂 Loading trained models...
2025-06-17 21:03:28,979 - INFO - FixedBC_138979809252256 - ✅ World model loaded successfully
2025-06-17 21:03:28,979 - INFO - FixedBC_138979809252256 - 🔧 Step 1: Creating supervised-to-RL adapter...
2025-06-17 21:03:29,503 - INFO - FixedBC_138979809252256 - ✅ Loaded supervised model for behavioral cloning
2025-06-17 21:03:29,503 - INFO - FixedBC_138979809252256 -    Original performance: 48.3% mAP
2025-06-17 21:03:29,503 - INFO - FixedBC_138979809252256 -    Model handles sparse actions (0-3 out of 100)
2025-06-17 21:03:29,503 - INFO - FixedBC_138979809252256 - 🎯 Step 2: Creating sparse action environment...
2025-06-17 21:03:29,504 - INFO - FixedBC_138979809252256 - 🎯 Sparse Action Environment initialized
2025-06-17 21:03:29,504 - INFO - FixedBC_138979809252256 -    Optimized for 0-3 actions out of 100
2025-06-17 21:03:29,504 - INFO - FixedBC_138979809252256 -    Reward weights: {'sparse_expert_matching': 100.0, 'sparsity_reward': 20.0, 'false_positive_penalty': 30.0, 'completion_bonus': 5.0}
2025-06-17 21:03:29,504 - INFO - FixedBC_138979809252256 - 🎓 Step 3: Creating calibrated RL policy...
2025-06-17 21:03:29,504 - INFO - FixedBC_138979809252256 - 🔧 Creating calibrated RL policy from supervised model...
2025-06-17 21:03:29,520 - INFO - FixedBC_138979809252256 - 🎓 Step 4: Behavioral cloning pre-training...
2025-06-17 21:03:29,520 - INFO - FixedBC_138979809252256 - 🎓 Pre-training RL policy with behavioral cloning...
2025-06-17 21:03:29,520 - INFO - FixedBC_138979809252256 -    Handling sparse action space (0-3 actions out of 100)
2025-06-17 21:05:59,321 - INFO - FixedBC_138979809252256 - ✅ Collected 100 behavioral cloning samples
2025-06-17 21:05:59,323 - INFO - FixedBC_138979809252256 -    Average active actions per frame: 1.2
2025-06-17 21:05:59,323 - INFO - FixedBC_138979809252256 -    Action sparsity: 98.8%
2025-06-17 21:05:59,325 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,326 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,326 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,326 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,326 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,326 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,326 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,326 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,327 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,327 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,327 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,327 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,327 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (4x1024 and 64x100)
2025-06-17 21:05:59,327 - ERROR - FixedBC_138979809252256 - ❌ No successful batches in epoch 1
2025-06-17 21:05:59,327 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,328 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,329 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,329 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,329 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (8x1024 and 64x100)
2025-06-17 21:05:59,329 - WARNING - FixedBC_138979809252256 - BC training batch failed: mat1 and mat2 shapes cannot be multiplied (4x1024 and 64x100)
2025-06-17 21:05:59,329 - ERROR - FixedBC_138979809252256 - ❌ No successful batches in epoch 2
2025-06-17 21:05:59,329 - INFO - FixedBC_138979809252256 - ✅ Behavioral cloning pre-training completed
2025-06-17 21:05:59,329 - INFO - FixedBC_138979809252256 - 🔍 Step 5: Testing initial calibration...
2025-06-17 21:05:59,356 - INFO - FixedBC_138979809252256 -    Sparsity analysis: Expert 1.4, Predicted 0.0
2025-06-17 21:05:59,356 - INFO - FixedBC_138979809252256 -    Initial test mAP after BC: 0.2129
2025-06-17 21:05:59,356 - INFO - FixedBC_138979809252256 - 🚀 Step 6: Sparse action optimized RL training...
