2025-06-23 10:57:01,476 - INFO - SuRL_FixedRL_140531542982720 - Shared experiment log directory: results/2025-06-23_10-57-01/fold0/logs
2025-06-23 10:57:01,476 - INFO - SuRL_FixedRL_140531542982720 - üéØ RL Experiment: 2025-06-23_10-57-01
2025-06-23 10:57:01,476 - INFO - SuRL_FixedRL_140531542982720 - üìÅ Results dir: results/2025-06-23_10-57-01/fold0
2025-06-23 10:57:01,477 - INFO - SuRL_FixedRL_140531542982720 - üöÄ Starting Complete RL Comparison
2025-06-23 10:57:01,477 - INFO - SuRL_FixedRL_140531542982720 - ============================================================
2025-06-23 10:57:01,477 - INFO - SuRL_FixedRL_140531542982720 - üìÇ Loading CholecT50 data...
2025-06-23 10:57:01,477 - INFO - SuRL_FixedRL_140531542982720 -    Training videos: 40
2025-06-23 10:57:01,477 - INFO - SuRL_FixedRL_140531542982720 -    Test videos: 10
2025-06-23 10:57:01,477 - INFO - SuRL_FixedRL_140531542982720 - Loading train data from /nfs/home/mboels/datasets/CholecT50 with fold 0
2025-06-23 10:57:03,521 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded metadata: /nfs/home/mboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (78968, 156)
2025-06-23 10:57:03,521 - INFO - SuRL_FixedRL_140531542982720 - [Train] Start processing metadata file /nfs/home/mboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-23 10:57:03,522 - INFO - SuRL_FixedRL_140531542982720 - [Train] Rewards extraction skipped, using metadata file /nfs/home/mboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-23 10:57:03,527 - INFO - SuRL_FixedRL_140531542982720 - [Train] Found 40 videos in metadata file
2025-06-23 10:57:03,527 - INFO - SuRL_FixedRL_140531542982720 - [Train] Loading data for 40 videos
2025-06-23 10:57:05,901 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID01: 1734 frames, 1024-dims embeddings
2025-06-23 10:57:08,447 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID04: 1523 frames, 1024-dims embeddings
2025-06-23 10:57:11,524 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID05: 2345 frames, 1024-dims embeddings
2025-06-23 10:57:13,501 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID08: 1520 frames, 1024-dims embeddings
2025-06-23 10:57:16,457 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID10: 1750 frames, 1024-dims embeddings
2025-06-23 10:57:20,154 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID103: 2220 frames, 1024-dims embeddings
2025-06-23 10:57:23,951 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID110: 2177 frames, 1024-dims embeddings
2025-06-23 10:57:25,550 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID12: 1091 frames, 1024-dims embeddings
2025-06-23 10:57:27,316 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID13: 982 frames, 1024-dims embeddings
2025-06-23 10:57:30,440 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID15: 2059 frames, 1024-dims embeddings
2025-06-23 10:57:33,873 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID18: 1943 frames, 1024-dims embeddings
2025-06-23 10:57:36,701 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID22: 1533 frames, 1024-dims embeddings
2025-06-23 10:57:39,890 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID26: 1774 frames, 1024-dims embeddings
2025-06-23 10:57:42,763 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID27: 2085 frames, 1024-dims embeddings
2025-06-23 10:57:45,933 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID29: 2351 frames, 1024-dims embeddings
2025-06-23 10:57:51,164 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID31: 3946 frames, 1024-dims embeddings
2025-06-23 10:57:54,769 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID32: 2117 frames, 1024-dims embeddings
2025-06-23 10:57:57,630 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID35: 2107 frames, 1024-dims embeddings
2025-06-23 10:58:00,794 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID36: 2388 frames, 1024-dims embeddings
2025-06-23 10:58:03,764 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID40: 2223 frames, 1024-dims embeddings
2025-06-23 10:58:09,987 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID42: 3713 frames, 1024-dims embeddings
2025-06-23 10:58:14,160 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID43: 2363 frames, 1024-dims embeddings
2025-06-23 10:58:18,122 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID47: 2260 frames, 1024-dims embeddings
2025-06-23 10:58:20,727 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID48: 1835 frames, 1024-dims embeddings
2025-06-23 10:58:23,574 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID49: 1672 frames, 1024-dims embeddings
2025-06-23 10:58:26,334 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID52: 1967 frames, 1024-dims embeddings
2025-06-23 10:58:29,367 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID56: 1837 frames, 1024-dims embeddings
2025-06-23 10:58:33,767 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID57: 2633 frames, 1024-dims embeddings
2025-06-23 10:58:37,992 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID60: 2533 frames, 1024-dims embeddings
2025-06-23 10:58:40,707 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID62: 2033 frames, 1024-dims embeddings
2025-06-23 10:58:43,167 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID65: 1874 frames, 1024-dims embeddings
2025-06-23 10:58:45,858 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID68: 1973 frames, 1024-dims embeddings
2025-06-23 10:58:47,921 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID70: 1195 frames, 1024-dims embeddings
2025-06-23 10:58:49,717 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID73: 1357 frames, 1024-dims embeddings
2025-06-23 10:58:51,975 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID74: 1635 frames, 1024-dims embeddings
2025-06-23 10:58:54,667 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID75: 1924 frames, 1024-dims embeddings
2025-06-23 10:58:55,948 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID78: 740 frames, 1024-dims embeddings
2025-06-23 10:58:58,861 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID80: 1725 frames, 1024-dims embeddings
2025-06-23 10:59:02,498 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID92: 2124 frames, 1024-dims embeddings
2025-06-23 10:59:04,945 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID96: 1707 frames, 1024-dims embeddings
2025-06-23 10:59:04,946 - INFO - SuRL_FixedRL_140531542982720 - üìÇ Loaded 40 videos from train split
2025-06-23 10:59:04,960 - INFO - SuRL_FixedRL_140531542982720 - Loading test data from /nfs/home/mboels/datasets/CholecT50 with fold 0
2025-06-23 10:59:05,517 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded metadata: /nfs/home/mboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (21895, 156)
2025-06-23 10:59:05,518 - INFO - SuRL_FixedRL_140531542982720 - [Test] Start processing metadata file /nfs/home/mboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-23 10:59:05,544 - INFO - SuRL_FixedRL_140531542982720 - [Test] Cleaned metadata file paths in /nfs/home/mboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-23 10:59:08,416 - INFO - SuRL_FixedRL_140531542982720 - [Test] Saved cleaned metadata to /nfs/home/mboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-23 10:59:08,417 - INFO - SuRL_FixedRL_140531542982720 - [Test] Rewards extraction skipped, using metadata file /nfs/home/mboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-06-23 10:59:08,420 - INFO - SuRL_FixedRL_140531542982720 - [Test] Found 10 videos in metadata file
2025-06-23 10:59:08,420 - INFO - SuRL_FixedRL_140531542982720 - [Test] Loading data for 10 videos
2025-06-23 10:59:12,367 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID02: 2840 frames, 1024-dims embeddings
2025-06-23 10:59:16,048 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID06: 2154 frames, 1024-dims embeddings
2025-06-23 10:59:19,794 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID111: 2146 frames, 1024-dims embeddings
2025-06-23 10:59:22,824 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID14: 1709 frames, 1024-dims embeddings
2025-06-23 10:59:25,721 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID23: 1636 frames, 1024-dims embeddings
2025-06-23 10:59:29,519 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID25: 2130 frames, 1024-dims embeddings
2025-06-23 10:59:31,439 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID50: 1095 frames, 1024-dims embeddings
2025-06-23 10:59:36,528 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID51: 2945 frames, 1024-dims embeddings
2025-06-23 10:59:39,489 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID66: 1825 frames, 1024-dims embeddings
2025-06-23 10:59:45,177 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Loaded video VID79: 3415 frames, 1024-dims embeddings
2025-06-23 10:59:45,179 - INFO - SuRL_FixedRL_140531542982720 - üìÇ Loaded 10 videos from test split
2025-06-23 10:59:45,186 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Data loaded successfully
2025-06-23 10:59:45,186 - INFO - SuRL_FixedRL_140531542982720 -    Training videos: 40
2025-06-23 10:59:45,186 - INFO - SuRL_FixedRL_140531542982720 -    Test videos: 10
2025-06-23 10:59:45,186 - INFO - SuRL_FixedRL_140531542982720 - üéì Running Method 1: Autoregressive IL
2025-06-23 10:59:45,186 - INFO - SuRL_FixedRL_140531542982720 - üéì Method 1: Autoregressive IL
2025-06-23 10:59:45,186 - INFO - SuRL_FixedRL_140531542982720 - ----------------------------------------
2025-06-23 11:00:03,220 - WARNING - SuRL_FixedRL_140531542982720 - ‚ö†Ô∏è Pretrained model enabled but no path specified
2025-06-23 11:00:03,220 - INFO - SuRL_FixedRL_140531542982720 - üîÑ Falling back to training from scratch...
2025-06-23 11:00:21,129 - INFO - SuRL_FixedRL_140531542982720 - üéì Autoregressive IL Trainer initialized (FINAL)
2025-06-23 11:00:21,129 - INFO - SuRL_FixedRL_140531542982720 -    Device: cuda
2025-06-23 11:00:21,129 - INFO - SuRL_FixedRL_140531542982720 -    Epochs: 2
2025-06-23 11:00:21,129 - INFO - SuRL_FixedRL_140531542982720 -    Learning rate: 3e-05
2025-06-23 11:00:21,130 - INFO - SuRL_FixedRL_140531542982720 -    ‚úÖ Per-video aggregation + shared metrics + efficient validation
2025-06-23 11:00:21,130 - INFO - SuRL_FixedRL_140531542982720 - üéì Starting Autoregressive IL Training...
2025-06-23 11:00:21,130 - INFO - SuRL_FixedRL_140531542982720 - üéØ Goal: Learn causal frame generation ‚Üí action prediction
2025-06-23 11:00:21,130 - INFO - SuRL_FixedRL_140531542982720 - üìä Evaluation: Per-video aggregation for robust metrics
2025-06-23 11:03:22,886 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID02 validation:    Loss: 0.5383,    Action mAP: 0.4503
2025-06-23 11:03:28,085 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID06 validation:    Loss: 0.4481,    Action mAP: 0.5441
2025-06-23 11:03:32,765 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID111 validation:    Loss: 0.9246,    Action mAP: 0.4770
2025-06-23 11:03:37,027 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID14 validation:    Loss: 0.7769,    Action mAP: 0.3299
2025-06-23 11:03:41,048 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID23 validation:    Loss: 0.8611,    Action mAP: 0.4373
2025-06-23 11:03:45,942 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID25 validation:    Loss: 0.5673,    Action mAP: 0.6564
2025-06-23 11:03:48,621 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID50 validation:    Loss: 0.3020,    Action mAP: 0.5826
2025-06-23 11:03:54,943 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID51 validation:    Loss: 0.5665,    Action mAP: 0.4840
2025-06-23 11:03:59,251 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID66 validation:    Loss: 0.3480,    Action mAP: 0.6281
2025-06-23 11:04:06,992 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID79 validation:    Loss: 0.3855,    Action mAP: 0.3910
2025-06-23 11:04:06,996 - INFO - SuRL_FixedRL_140531542982720 - üìä Validation Summary (averaged across 10 videos):
2025-06-23 11:04:06,996 - INFO - SuRL_FixedRL_140531542982720 -    üéØ Main mAP (surgical actions): 0.4981 ¬± 0.0988
2025-06-23 11:04:06,996 - INFO - SuRL_FixedRL_140531542982720 -    üìä mAP with null verbs: 0.4543
2025-06-23 11:04:06,996 - INFO - SuRL_FixedRL_140531542982720 -    üìã Actions evaluated: 25/94 surgical actions
2025-06-23 11:04:06,996 - INFO - SuRL_FixedRL_140531542982720 -    üìà Surgical action sparsity: 0.7309
2025-06-23 11:04:06,996 - INFO - SuRL_FixedRL_140531542982720 -    üîÑ Total Loss: 0.5718
2025-06-23 11:04:07,500 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ New best model saved: results/2025-06-23_10-57-01/fold0/logs/checkpoints/autoregressive_il_best_epoch_1.pt
2025-06-23 11:04:07,500 - INFO - SuRL_FixedRL_140531542982720 - Epoch 1/2 | Train Loss: 0.4389 | Val Loss: 0.5718 | Action mAP: 0.4981¬±0.0988 (10 videos) | Frame MSE: 0.1771
2025-06-23 11:07:11,796 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID02 validation:    Loss: 0.5817,    Action mAP: 0.4411
2025-06-23 11:07:18,030 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID06 validation:    Loss: 0.4407,    Action mAP: 0.5728
2025-06-23 11:07:22,969 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID111 validation:    Loss: 0.8288,    Action mAP: 0.4704
2025-06-23 11:07:27,465 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID14 validation:    Loss: 0.8393,    Action mAP: 0.3291
2025-06-23 11:07:31,887 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID23 validation:    Loss: 0.9033,    Action mAP: 0.4518
2025-06-23 11:07:37,543 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID25 validation:    Loss: 0.5758,    Action mAP: 0.6673
2025-06-23 11:07:40,751 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID50 validation:    Loss: 0.3159,    Action mAP: 0.5755
2025-06-23 11:07:47,831 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID51 validation:    Loss: 0.5388,    Action mAP: 0.4831
2025-06-23 11:07:52,335 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID66 validation:    Loss: 0.3518,    Action mAP: 0.6221
2025-06-23 11:08:00,416 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID79 validation:    Loss: 0.4362,    Action mAP: 0.3859
2025-06-23 11:08:00,420 - INFO - SuRL_FixedRL_140531542982720 - üìä Validation Summary (averaged across 10 videos):
2025-06-23 11:08:00,420 - INFO - SuRL_FixedRL_140531542982720 -    üéØ Main mAP (surgical actions): 0.4999 ¬± 0.1015
2025-06-23 11:08:00,420 - INFO - SuRL_FixedRL_140531542982720 -    üìä mAP with null verbs: 0.4560
2025-06-23 11:08:00,420 - INFO - SuRL_FixedRL_140531542982720 -    üìã Actions evaluated: 25/94 surgical actions
2025-06-23 11:08:00,420 - INFO - SuRL_FixedRL_140531542982720 -    üìà Surgical action sparsity: 0.7309
2025-06-23 11:08:00,420 - INFO - SuRL_FixedRL_140531542982720 -    üîÑ Total Loss: 0.5812
2025-06-23 11:08:00,453 - INFO - SuRL_FixedRL_140531542982720 - Epoch 2/2 | Train Loss: 0.2473 | Val Loss: 0.5812 | Action mAP: 0.4999¬±0.1015 (10 videos) | Frame MSE: 0.1697
2025-06-23 11:08:03,657 - INFO - SuRL_FixedRL_140531542982720 - üìä Per-video analysis saved to: results/2025-06-23_10-57-01/fold0/logs/per_video_performance_analysis.png
2025-06-23 11:08:03,658 - INFO - SuRL_FixedRL_140531542982720 - üìä Performance data saved to: results/2025-06-23_10-57-01/fold0/logs/per_video_performance_data.json
2025-06-23 11:08:03,658 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Autoregressive IL Training completed!
2025-06-23 11:08:03,658 - INFO - SuRL_FixedRL_140531542982720 - üìÑ Best model: results/2025-06-23_10-57-01/fold0/logs/checkpoints/autoregressive_il_best_epoch_1.pt
2025-06-23 11:08:03,658 - INFO - SuRL_FixedRL_140531542982720 - üìÑ Final model: results/2025-06-23_10-57-01/fold0/logs/checkpoints/autoregressive_il_final.pt
2025-06-23 11:08:03,658 - INFO - SuRL_FixedRL_140531542982720 - üìä Per-video analysis saved
2025-06-23 11:08:03,658 - INFO - SuRL_FixedRL_140531542982720 - üìä Evaluating Autoregressive IL Model (PER-VIDEO)...
2025-06-23 11:08:10,792 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID02 validation:    Loss: 0.5817,    Action mAP: 0.4411
2025-06-23 11:08:16,922 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID06 validation:    Loss: 0.4407,    Action mAP: 0.5728
2025-06-23 11:08:21,790 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID111 validation:    Loss: 0.8288,    Action mAP: 0.4704
2025-06-23 11:08:26,486 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID14 validation:    Loss: 0.8393,    Action mAP: 0.3291
2025-06-23 11:08:30,636 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID23 validation:    Loss: 0.9033,    Action mAP: 0.4518
2025-06-23 11:08:35,690 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID25 validation:    Loss: 0.5758,    Action mAP: 0.6673
2025-06-23 11:08:38,733 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID50 validation:    Loss: 0.3159,    Action mAP: 0.5755
2025-06-23 11:08:45,419 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID51 validation:    Loss: 0.5388,    Action mAP: 0.4831
2025-06-23 11:08:49,792 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID66 validation:    Loss: 0.3518,    Action mAP: 0.6221
2025-06-23 11:08:57,433 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Video VID79 validation:    Loss: 0.4362,    Action mAP: 0.3859
2025-06-23 11:08:57,435 - INFO - SuRL_FixedRL_140531542982720 - üìä Validation Summary (averaged across 10 videos):
2025-06-23 11:08:57,436 - INFO - SuRL_FixedRL_140531542982720 -    üéØ Main mAP (surgical actions): 0.4999 ¬± 0.1015
2025-06-23 11:08:57,436 - INFO - SuRL_FixedRL_140531542982720 -    üìä mAP with null verbs: 0.4560
2025-06-23 11:08:57,436 - INFO - SuRL_FixedRL_140531542982720 -    üìã Actions evaluated: 25/94 surgical actions
2025-06-23 11:08:57,436 - INFO - SuRL_FixedRL_140531542982720 -    üìà Surgical action sparsity: 0.7309
2025-06-23 11:08:57,436 - INFO - SuRL_FixedRL_140531542982720 -    üîÑ Total Loss: 0.5812
2025-06-23 11:08:57,440 - INFO - SuRL_FixedRL_140531542982720 - üìä Evaluating generation quality...
2025-06-23 11:08:59,227 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Per-video evaluation completed
2025-06-23 11:08:59,228 - INFO - SuRL_FixedRL_140531542982720 - üìä Overall Action mAP: 0.4999 ¬± 0.0000
2025-06-23 11:08:59,228 - INFO - SuRL_FixedRL_140531542982720 - üìä Videos evaluated: 10
2025-06-23 11:08:59,228 - INFO - SuRL_FixedRL_140531542982720 - üéØ Aggregation: Per-video metrics ‚Üí averaged
2025-06-23 11:09:01,486 - INFO - SuRL_FixedRL_140531542982720 - ----------------------------------------
2025-06-23 11:09:01,486 - INFO - SuRL_FixedRL_140531542982720 - ----------------------------------------
2025-06-23 11:09:01,486 - INFO - SuRL_FixedRL_140531542982720 - üåç Method 2: Conditional World Model + RL
2025-06-23 11:09:01,486 - INFO - SuRL_FixedRL_140531542982720 - ----------------------------------------
2025-06-23 11:09:01,487 - INFO - SuRL_FixedRL_140531542982720 - ----------------------------------------
2025-06-23 11:09:01,487 - INFO - SuRL_FixedRL_140531542982720 - üìÇ Using pretrained world model from: results/fixed_rl_2025-06-13_19-22-25/logs/checkpoints/world_model_best_epoch_1.pt
2025-06-23 11:09:02,429 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Pretrained world model loaded successfully
2025-06-23 11:09:11,013 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Stored test loaders for evaluation: ['VID02', 'VID06', 'VID111', 'VID14', 'VID23', 'VID25', 'VID50', 'VID51', 'VID66', 'VID79']
2025-06-23 11:09:11,031 - INFO - SuRL_FixedRL_140531542982720 - üåç World Model Trainer initialized
2025-06-23 11:09:11,032 - INFO - SuRL_FixedRL_140531542982720 -    Device: cuda
2025-06-23 11:09:11,032 - INFO - SuRL_FixedRL_140531542982720 -    Epochs: 2
2025-06-23 11:09:11,032 - INFO - SuRL_FixedRL_140531542982720 -    Learning rate: 3e-05
2025-06-23 11:09:11,032 - INFO - SuRL_FixedRL_140531542982720 -    Focus: Action-conditioned state-reward prediction
2025-06-23 11:09:11,032 - INFO - SuRL_FixedRL_140531542982720 - üìä Step 1: Evaluating pretrained world model...
2025-06-23 11:09:11,032 - INFO - SuRL_FixedRL_140531542982720 - üìä Evaluating World Model...
2025-06-23 11:09:34,837 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Evaluation completed
2025-06-23 11:09:34,838 - INFO - SuRL_FixedRL_140531542982720 - üìä State Loss: 0.1604
2025-06-23 11:09:34,838 - INFO - SuRL_FixedRL_140531542982720 - üìä Reward Loss: 0.0691
2025-06-23 11:09:34,838 - INFO - SuRL_FixedRL_140531542982720 - üöÄ Step 2: Starting RL Policy training...
2025-06-23 11:09:34,839 - INFO - SuRL_FixedRL_140531542982720 - üîß RL Trainer initialized with config: {'debug': False, 'experiment': {'train': {'max_videos': 40}, 'test': {'max_videos': 10, 'test_on_train': False}, 'autoregressive_il': {'enabled': True, 'il_model_path': None}, 'world_model': {'enabled': False, 'wm_model_path': 'results/fixed_rl_2025-06-13_19-22-25/logs/checkpoints/world_model_best_epoch_1.pt'}, 'rl_experiments': {'enabled': False, 'eval_episodes': 10}}, 'training': {'epochs': 2, 'batch_size': 16, 'learning_rate': 3e-05, 'log_every_n_steps': 50, 'scheduler': {'type': 'cosine', 'warmup_steps': 100}, 'weight_decay': 0.01, 'gradient_clip_val': 1.0, 'dropout': 0.1, 'num_workers': 4, 'pin_memory': True, 'log_dir': 'logs', 'checkpoint_dir': 'checkpoints', 'eval_epoch_interval': 1, 'save_model': True}, 'evaluation': {'prediction_horizon': 15, 'supervised': {'action_prediction': True}, 'rl': {'rollout_horizon': 15, 'use_best_actions': True}, 'comparison': {'statistical_tests': True, 'effect_size_threshold': 0.2}, 'world_model': {'use_memory': False, 'overall_horizon': 1}}, 'rl_training': {'action_space_type': 'continuous', 'outcome_based_rewards': True, 'rl_horizon': 30, 'reward_mode': 'dense', 'normalize_rewards': True, 'early_termination': True, 'timesteps': 50000, 'reward_weights': {'expert_matching': 10.0, 'action_sparsity': 1.0, 'world_model_rewards': 0.5, 'completion_bonus': 5.0, 'consistency_bonus': 1.0, 'phase_completion': 1.0, 'risk_penalty': -0.5}, 'ppo': {'learning_rate': '5e-5', 'n_steps': 512, 'batch_size': 64, 'n_epochs': 10, 'gamma': 0.95, 'gae_lambda': 0.9, 'clip_range': 0.1, 'ent_coef': 0.05, 'vf_coef': 0.5, 'max_grad_norm': 0.5}, 'a2c': {'learning_rate': '1e-4', 'n_steps': 32, 'gamma': 0.95, 'gae_lambda': 0.9, 'ent_coef': 0.05, 'vf_coef': 0.25, 'max_grad_norm': 0.5}}, 'data': {'context_length': 20, 'train_shift': 1, 'padding_value': 0.0, 'max_horizon': 15, 'paths': {'data_dir': '/nfs/home/mboels/datasets/CholecT50', 'class_labels_file_path': './data/labels.json', 'fold': 0, 'metadata_file': 'embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv', 'video_global_outcome_file': 'embeddings_f1_swin_bas_129_with_enhanced_global_metrics.csv'}, 'frame_risk_agg': 'max'}, 'training_mode': 'rl', 'preprocess': {'extract_rewards': False, 'analyze_rewards': False, 'rewards': {'grounded': {'phase_completion': True, 'phase_transition': True, 'phase_progression': True, 'global_progression': True}, 'imitation': {'action_distribution': True}, 'expert_knowledge': {'risk_score': True, 'frame_risk_agg': 'max'}}}, 'models': {'autoregressive_il': {'hidden_dim': 768, 'embedding_dim': 1024, 'n_layer': 6, 'num_action_classes': 100, 'num_phase_classes': 7, 'dropout': 0.1, 'max_length': 1024}, 'conditional_world_model': {'hidden_dim': 512, 'embedding_dim': 1024, 'action_embedding_dim': 128, 'n_layer': 4, 'num_action_classes': 100, 'num_phase_classes': 7, 'dropout': 0.1, 'max_sequence_length': 512}}, 'fair_evaluation': {'enabled': True, 'include_traditional_metrics': True, 'include_clinical_metrics': True, 'clinical_outcome_weights': {'phase_progression': 2.0, 'innovation': 0.5}}, 'supervised_learning': {'data_augmentation': False}, 'research_comparison': {'methods': ['autoregressive_il', 'conditional_world_model', 'direct_video_rl']}, 'advanced': {'mixed_precision': False}, 'hardware': {'persistent_workers': True}, 'rl_debugging': {'enabled': True, 'save_training_curves': True, 'monitor_expert_matching': True, 'log_action_distributions': True, 'convergence_analysis': True, 'episode_log_frequency': 10, 'eval_frequency': 1000, 'reward_improvement_threshold': 0.1, 'expert_matching_threshold': 0.5, 'debug_dir': 'rl_debug', 'plot_dir': 'rl_plots'}}
2025-06-23 11:09:34,839 - INFO - SuRL_FixedRL_140531542982720 - üìÇ Results will be saved to: results/2025-06-23_10-57-01/fold0/logs/rl_training
2025-06-23 11:09:34,839 - INFO - SuRL_FixedRL_140531542982720 - üåç Training World Model RL with PPO...
2025-06-23 11:09:34,839 - INFO - SuRL_FixedRL_140531542982720 - --------------------------------------------------
2025-06-23 11:09:34,839 - INFO - SuRL_FixedRL_140531542982720 - üåç Training PPO with World Model
2025-06-23 11:09:34,839 - INFO - SuRL_FixedRL_140531542982720 - --------------------------------------------------
2025-06-23 11:09:34,841 - INFO - SuRL_FixedRL_140531542982720 - üåç World Model Simulation Environment initialized
2025-06-23 11:09:34,841 - INFO - SuRL_FixedRL_140531542982720 - üîß Action space: Box(0.0, 1.0, (100,), float32)
2025-06-23 11:09:34,841 - INFO - SuRL_FixedRL_140531542982720 - üìä Max episode steps: 30
2025-06-23 11:09:34,841 - INFO - SuRL_FixedRL_140531542982720 - üéØ Focus: Expert demonstration matching + world model simulation
2025-06-23 11:09:34,842 - INFO - SuRL_FixedRL_140531542982720 - üåç World Model Simulation Environment initialized
2025-06-23 11:09:34,842 - INFO - SuRL_FixedRL_140531542982720 - üîß Action space: Box(0.0, 1.0, (100,), float32)
2025-06-23 11:09:34,842 - INFO - SuRL_FixedRL_140531542982720 - üìä Max episode steps: 30
2025-06-23 11:09:34,842 - INFO - SuRL_FixedRL_140531542982720 - üéØ Focus: Expert demonstration matching + world model simulation
2025-06-23 11:09:34,853 - INFO - SuRL_FixedRL_140531542982720 - ‚úÖ Environment test: Reward=5.817, Action shape=(100,)
2025-06-23 11:09:37,359 - INFO - SuRL_FixedRL_140531542982720 - üöÄ Training for 50000 timesteps with enhanced monitoring...
