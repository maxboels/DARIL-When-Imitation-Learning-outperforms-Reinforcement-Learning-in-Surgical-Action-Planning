2025-07-02 11:35:54,052 - INFO - SuRL_FixedRL_126829561901136 - Shared experiment log directory: results/2025-07-02_11-35-54/fold0/logs
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - üéØ RL Experiment: 2025-07-02_11-35-54
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - üìÅ Results dir: results/2025-07-02_11-35-54/fold0
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - üìÇ Plots dir: results/2025-07-02_11-35-54/fold0/publication_plots
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - üöÄ Starting Complete RL Comparison
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - ============================================================
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - üìÇ Loading CholecT50 data...
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 -    Training videos: 2
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 -    Test videos: 2
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Using data directory: /home/maxboels/datasets/CholecT50
2025-07-02 11:35:54,053 - INFO - SuRL_FixedRL_126829561901136 - Loading train data from /home/maxboels/datasets/CholecT50 with fold 0
2025-07-02 11:35:54,460 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Loaded metadata: /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (78968, 156)
2025-07-02 11:35:54,460 - INFO - SuRL_FixedRL_126829561901136 - [Train] Start processing metadata file /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-07-02 11:35:54,461 - INFO - SuRL_FixedRL_126829561901136 - [Train] Rewards extraction skipped, using metadata file /home/maxboels/datasets/CholecT50/embeddings_train_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-07-02 11:35:54,462 - INFO - SuRL_FixedRL_126829561901136 - [Train] Found 2 videos in metadata file
2025-07-02 11:35:54,462 - INFO - SuRL_FixedRL_126829561901136 - [Train] Loading data for 2 videos
2025-07-02 11:35:54,541 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Loaded video VID01: 1734 frames, 1024-dims embeddings
2025-07-02 11:35:54,607 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Loaded video VID04: 1523 frames, 1024-dims embeddings
2025-07-02 11:35:54,607 - INFO - SuRL_FixedRL_126829561901136 - üìÇ Loaded 2 videos from train split
2025-07-02 11:35:54,607 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Using data directory: /home/maxboels/datasets/CholecT50
2025-07-02 11:35:54,607 - INFO - SuRL_FixedRL_126829561901136 - Loading test data from /home/maxboels/datasets/CholecT50 with fold 0
2025-07-02 11:35:54,685 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Loaded metadata: /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv - Shape: (21895, 156)
2025-07-02 11:35:54,686 - INFO - SuRL_FixedRL_126829561901136 - [Test] Start processing metadata file /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-07-02 11:35:54,686 - INFO - SuRL_FixedRL_126829561901136 - [Test] Rewards extraction skipped, using metadata file /home/maxboels/datasets/CholecT50/embeddings_test_set/fold0/embeddings_f0_swin_bas_129_phase_complet_phase_transit_prog_prob_action_risk_glob_outcome.csv
2025-07-02 11:35:54,686 - INFO - SuRL_FixedRL_126829561901136 - [Test] Found 2 videos in metadata file
2025-07-02 11:35:54,686 - INFO - SuRL_FixedRL_126829561901136 - [Test] Loading data for 2 videos
2025-07-02 11:35:54,803 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Loaded video VID02: 2840 frames, 1024-dims embeddings
2025-07-02 11:35:54,893 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Loaded video VID06: 2154 frames, 1024-dims embeddings
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - üìÇ Loaded 2 videos from test split
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ Data loaded successfully
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 -    Training videos: 2
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 -    Test videos: 2
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - üéì Method 1: Autoregressive IL is disabled, skipping...
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - üåç Method 2: Conditional World Model + RL is disabled, skipping...
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - üìπ Method 3: Direct Video RL is disabled, skipping...
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - üéØ Running Method 4: IRL Enhancement
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - üéØ Method 4: IRL Enhancement for Next Action Prediction
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 -    Matching AutoregressiveIL temporal structure and task definition
2025-07-02 11:35:54,894 - INFO - SuRL_FixedRL_126829561901136 - ----------------------------------------
2025-07-02 11:35:55,083 - INFO - SuRL_FixedRL_126829561901136 - üìÇ Loaded IL model from: best_checkpoints/autoregressive_il_best_combined_epoch_8.pt
2025-07-02 11:35:55,087 - INFO - SuRL_FixedRL_126829561901136 - üéØ Training IRL for Next Action Prediction (Matching IL Approach)
2025-07-02 11:35:55,263 - INFO - SuRL_FixedRL_126829561901136 - üéØ Training IRL for Next Action Prediction (2 epochs)
2025-07-02 11:35:55,263 - INFO - SuRL_FixedRL_126829561901136 -    Training batches per epoch: 346
2025-07-02 11:35:55,263 - INFO - SuRL_FixedRL_126829561901136 -    Task: Learn rewards for next_action(t+1) predictions
2025-07-02 11:36:01,311 - INFO - SuRL_FixedRL_126829561901136 - Epoch 1 completed: Avg Loss = 1.9872
2025-07-02 11:36:07,383 - INFO - SuRL_FixedRL_126829561901136 - Epoch 2 completed: Avg Loss = 1.5913
2025-07-02 11:36:07,383 - INFO - SuRL_FixedRL_126829561901136 - üéÆ Training policy adjustment for next action prediction...
2025-07-02 11:36:07,384 - INFO - SuRL_FixedRL_126829561901136 - üéÆ Training Policy Adjustment for Next Action Prediction
2025-07-02 11:36:13,839 - INFO - SuRL_FixedRL_126829561901136 - Policy epoch 1: Next Action Loss = -0.5921
2025-07-02 11:36:20,453 - INFO - SuRL_FixedRL_126829561901136 - Policy epoch 2: Next Action Loss = -0.5976
2025-07-02 11:36:20,454 - INFO - SuRL_FixedRL_126829561901136 - ‚úÖ IRL Next Action Prediction training completed
2025-07-02 11:36:30,460 - ERROR - SuRL_FixedRL_126829561901136 - ‚ùå Method 4 IRL Next Action failed: The size of tensor a (2620) must match the size of tensor b (4) at non-singleton dimension 0
2025-07-02 11:36:30,462 - ERROR - SuRL_FixedRL_126829561901136 - Full traceback: Traceback (most recent call last):
  File "/home/maxboels/projects/surl/training/irl_next_action_trainer.py", line 368, in _calculate_map
    ap = average_precision_score(target_np[:, i], pred_np[:, i])
         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/utils/_param_validation.py", line 213, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/metrics/_ranking.py", line 268, in average_precision_score
    return _average_binary_score(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/metrics/_base.py", line 76, in _average_binary_score
    return binary_metric(y_true, y_score, sample_weight=sample_weight)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/metrics/_ranking.py", line 230, in _binary_uninterpolated_average_precision
    precision, recall, _ = precision_recall_curve(
                           ^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/utils/_param_validation.py", line 186, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/metrics/_ranking.py", line 1002, in precision_recall_curve
    fps, tps, thresholds = _binary_clf_curve(
                           ^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/metrics/_ranking.py", line 819, in _binary_clf_curve
    check_consistent_length(y_true, y_score, sample_weight)
  File "/home/maxboels/.venv/lib/python3.12/site-packages/sklearn/utils/validation.py", line 457, in check_consistent_length
    raise ValueError(
ValueError: Found input variables with inconsistent numbers of samples: [4, 2620]

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/maxboels/projects/surl/run_experiment_v8.py", line 603, in _run_method4_irl_enhancement
    irl_results = train_irl_next_action_prediction(
                  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/projects/surl/training/irl_next_action_trainer.py", line 579, in train_irl_next_action_prediction
    evaluation_results = trainer.evaluate_next_action_prediction(test_loaders)
                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/projects/surl/training/irl_next_action_trainer.py", line 314, in evaluate_next_action_prediction
    il_score = self._calculate_map(il_next_predictions, target_next_actions)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/maxboels/projects/surl/training/irl_next_action_trainer.py", line 377, in _calculate_map
    accuracy = (pred_binary == targets).float().mean()
                ^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: The size of tensor a (2620) must match the size of tensor b (4) at non-singleton dimension 0

2025-07-02 11:36:30,462 - ERROR - SuRL_FixedRL_126829561901136 - ‚ùå No test loaders available for evaluation
